<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transformers.js v4 Hub Explorer</title>
</head>
<body style="font-family: sans-serif; line-height: 1.6; padding: 20px; color: #333; max-width: 900px; margin: auto; background: #f4f4f9;">

    <h1 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">Hugging Face Hub Explorer (v4)</h1>
    
    <div style="margin-bottom: 20px;">
        <label for="myModelInput">Model ID:</label>
        <input type="text" id="myModelInput" value="Xenova/all-MiniLM-L6-v2" style="padding: 8px; width: 250px;">
        <button onclick="myExploreModel()" style="padding: 8px 15px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">Explore Repository</button>
    </div>

    <div id="myStatus" style="font-style: italic; margin-bottom: 10px; color: #666;"></div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
            <h3>File List</h3>
            <div id="myFileList" style="background: #fff; border: 1px solid #ddd; padding: 10px; height: 300px; overflow-y: auto; border-radius: 5px;"></div>
        </div>
        <div>
            <h3>Metadata & Sizes</h3>
            <div id="myMetaList" style="background: #fff; border: 1px solid #ddd; padding: 10px; height: 300px; overflow-y: auto; border-radius: 5px;"></div>
        </div>
    </div>

    <script type="module">
        // Import Hub utilities from the v4 CDN
        import { 
            list_repo_files, 
            get_model_metadata 
        } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@4.0.0-next.3';

        const myStatus = document.getElementById('myStatus');
        const myFileListDiv = document.getElementById('myFileList');
        const myMetaListDiv = document.getElementById('myMetaList');

        window.myExploreModel = async function() {
            const myModelId = document.getElementById('myModelInput').value;
            
            myStatus.innerText = "Fetching data from Hugging Face...";
            myFileListDiv.innerHTML = "<em>Loading...</em>";
            myMetaListDiv.innerHTML = "<em>Loading...</em>";

            try {
                // 1. List files in the repo
                const myFiles = await list_repo_files(myModelId);
                
                // 2. Get detailed metadata (including sizes)
                const myMetadata = await get_model_metadata(myModelId);

                // Display file names
                myFileListDiv.innerHTML = `<ul style="padding-left: 20px;">${myFiles.map(f => `<li>${f}</li>`).join('')}</ul>`;

                // Display sizes from sibling information in metadata
                // Note: Metadata contains 'siblings' which are the actual file objects
                let mySizeHTML = `<table style="width:100%; border-collapse: collapse;">
                    <tr style="background:#eee;"><th style="text-align:left; padding:5px;">File</th><th style="text-align:right; padding:5px;">Size</th></tr>`;
                
                myMetadata.siblings.forEach(myFileObj => {
                    const mySizeMB = myFileObj.size ? (myFileObj.size / (1024 * 1024)).toFixed(2) + " MB" : "Unknown";
                    mySizeHTML += `<tr style="border-bottom: 1px solid #eee;">
                        <td style="padding:5px; font-size:0.85em;">${myFileObj.rfilename}</td>
                        <td style="padding:5px; text-align:right; font-size:0.85em;">${mySizeMB}</td>
                    </tr>`;
                });
                mySizeHTML += `</table>`;
                
                myMetaListDiv.innerHTML = mySizeHTML;
                myStatus.innerText = "Ready.";

            } catch (myError) {
                myStatus.innerText = "Error: " + myError.message;
                myFileListDiv.innerText = "Failed to load.";
                myMetaListDiv.innerText = "Failed to load.";
            }
        };
    </script>
</body>
</html>
